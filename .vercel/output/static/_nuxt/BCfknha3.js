import{B as O,C as _,h as u,l as F,k as A,D as P,c as G,a as s,e as z,b as p,g as N,i as V,w as l,x as n,y as J,E as B,r as I,o as T,d as y,n as R,t as x}from"./SG-_7NVK.js";import{s as $}from"./x_rD_Ya3.js";import{_ as W}from"./DlAUqK2U.js";const E=O("auth",{state:()=>({user:null,token:null,isLoading:!1,error:null}),getters:{isAuthenticated:e=>!!e.token,authToken:e=>e.token,userInfo:e=>e.user,bearerToken:e=>e.token?`Bearer ${e.token}`:null},actions:{async login(e,t){this.isLoading=!0,this.error=null;try{const a=await fetch("https://nhom2webkhachsan.runasp.net/api/allowanonymous/dangnhap",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tenTaiKhoan:e,matKhau:t})}),i=await a.json();return a.ok?(this.setUser({username:e}),this.setToken(i.token),{success:!0}):(this.error=i.message||"Sai tên tài khoản hoặc mật khẩu!",{success:!1,error:this.error})}catch(a){return this.error="Lỗi kết nối đến máy chủ. Vui lòng thử lại sau.",console.error("Login error:",a),{success:!1,error:this.error}}finally{this.isLoading=!1}},async loginWithGoogle(e){this.isLoading=!0,this.error=null;try{const t=await fetch("https://nhom2webkhachsan.runasp.net/api/allowanonymous/dangnhapgoogle",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,googleId:e.id})}),a=await t.json();return t.ok?(this.setUser({username:e.email,email:e.email,name:e.name,provider:"google"}),this.setToken(a.token||"google-token"),{success:!0}):(this.error=a.message||"Đăng nhập Google thất bại",{success:!1,error:this.error})}catch(t){return console.error("Google login error:",t),this.setUser({username:e.email,email:e.email,name:e.name,provider:"google"}),this.setToken("google-token"),{success:!0}}finally{this.isLoading=!1}},async loginWithFacebook(e){this.isLoading=!0,this.error=null;try{const t=await fetch("https://nhom2webkhachsan.runasp.net/api/allowanonymous/dangnhapfacebook",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,facebookId:e.id})}),a=await t.json();return t.ok?(this.setUser({username:e.email,email:e.email,name:e.name,provider:"facebook"}),this.setToken(a.token||"facebook-token"),{success:!0}):(this.error=a.message||"Đăng nhập Facebook thất bại",{success:!1,error:this.error})}catch(t){return console.error("Facebook login error:",t),this.setUser({username:e.email,email:e.email,name:e.name,provider:"facebook"}),this.setToken("facebook-token"),{success:!0}}finally{this.isLoading=!1}},logout(){this.user=null,this.token=null,localStorage.removeItem("userToken"),localStorage.removeItem("userName"),localStorage.removeItem("userInfo"),_(null)},setUser(e){this.user=e,localStorage.setItem("userInfo",JSON.stringify(e)),localStorage.setItem("userName",e.username)},setToken(e){this.token=e,localStorage.setItem("userToken",e),_(e)},initAuth(){const e=localStorage.getItem("userToken"),t=localStorage.getItem("userInfo");if(e&&(this.token=e,_(e)),t)try{this.user=JSON.parse(t)}catch{console.error("Error parsing user info from localStorage")}}}});function q(){const e=u(""),t=u(""),a=u(""),i=u(""),m=u(!1),c=u(""),h=P(),d=E(),b=["https://i.pinimg.com/474x/a0/fb/38/a0fb38a030da2a14a39767bfd21d48d2.jpg","https://i.pinimg.com/474x/d4/54/76/d45476a670996cd4ae936d99ad0b24e2.jpg","https://i.pinimg.com/474x/f7/41/c8/f741c8636021870390f124e5acaa55e4.jpg"],g=u(0),S=()=>{m.value=!m.value},f=async()=>{try{c.value="";const r=await d.login(a.value,i.value);r.success?(e.value=`Đăng nhập thành công: ${a.value}`,t.value="",setTimeout(()=>{h.push("/")},1e3)):c.value=r.error}catch(r){c.value="Lỗi kết nối đến máy chủ. Vui lòng thử lại sau.",console.error("Login error:",r)}},k=r=>{const o=JSON.parse(atob(r.credential.split(".")[1]));d.loginWithGoogle({email:o.email,name:o.name||o.email.split("@")[0]}),e.value=`Đăng nhập bằng Google: ${o.email}`,t.value=""},L=()=>{FB.login(r=>{r.status==="connected"?FB.api("/me",{fields:"name,email"},o=>{d.loginWithFacebook({email:o.email,name:o.name}),t.value=`Đăng nhập Facebook: ${o.name}`,e.value=`Email: ${o.email}`}):t.value="Chưa đăng nhập Facebook"},{scope:"email"})};return F(()=>{d.initAuth(),$(()=>{g.value=(g.value+1)%b.length},4e3);const r=document.createElement("script");r.src="https://accounts.google.com/gsi/client",r.async=!0,r.defer=!0,document.head.appendChild(r),r.onload=()=>{window.google.accounts.id.initialize({client_id:"351177417132-r5tq1fs5729agapblj6gpmsh0f230f36.apps.googleusercontent.com",callback:k}),window.google.accounts.id.renderButton(document.getElementById("g_id_signin"),{theme:"outline",size:"large",text:"signin_with"})},window.fbAsyncInit=function(){FB.init({appId:"2066643873763098",cookie:!0,xfbml:!0,version:"v12.0"})};const o=document.createElement("script");o.async=!0,o.defer=!0,o.crossOrigin="anonymous",o.src="https://connect.facebook.net/en_US/sdk.js",document.head.appendChild(o)}),{email:e,facebookName:t,formEmail:a,formPassword:i,images:b,currentImageIndex:g,showPassword:m,togglePassword:S,emailLogin:f,facebookLogin:L,isLoading:A(()=>d.isLoading),loginError:c}}const D={class:"login-page min-h-screen w-full flex items-center justify-center bg-cover bg-center",style:{"background-image":"url('/images/login-bg.jpg')"}},M={class:"login-modal bg-white rounded-md shadow-lg w-full max-w-md p-8 relative"},Y={class:"mb-4"},H={class:"mb-1"},Q={__name:"Login",setup(e){const t=P(),a=E(),{email:i,facebookName:m,formEmail:c,formPassword:h,showPassword:d,togglePassword:b,emailLogin:g,facebookLogin:S,isLoading:f,loginError:k}=q();F(()=>{a.initAuth(),a.isAuthenticated&&t.push("/")});const L=()=>{window.google&&window.google.accounts&&window.google.accounts.id?window.google.accounts.id.prompt():alert("Google sign-in is not available yet. Please try again later.")};return(r,o)=>{const w=I("va-button"),C=I("va-input"),j=I("va-alert");return T(),G("div",D,[s("div",M,[o[10]||(o[10]=z('<button class="absolute top-4 right-4 text-gray-400 hover:text-gray-600" data-v-3a8d647d><i class="fas fa-times" data-v-3a8d647d></i></button><div class="flex justify-center mb-5" data-v-3a8d647d><div class="avatar-placeholder w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center" data-v-3a8d647d><svg class="w-8 h-8 text-gray-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-v-3a8d647d><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" data-v-3a8d647d></path></svg></div></div><div class="text-center mb-6" data-v-3a8d647d><h1 class="text-xl font-semibold" data-v-3a8d647d>Log in</h1><p class="text-sm text-gray-500 mt-1" data-v-3a8d647d> Don&#39;t have an account? <a href="/Register" class="text-gray-900 font-medium hover:underline" data-v-3a8d647d>Sign up</a></p></div>',3)),p(w,{class:"w-full mb-3 justify-center",color:"transparent",border:"",onClick:n(S)},{prepend:l(()=>o[3]||(o[3]=[s("i",{class:"fab fa-facebook text-blue-600 me-2"},null,-1)])),default:l(()=>[o[4]||(o[4]=y(" Log in with Facebook "))]),_:1,__:[4]},8,["onClick"]),p(w,{class:"w-full mb-6 justify-center",color:"transparent",border:"",onClick:L},{prepend:l(()=>o[5]||(o[5]=[s("i",{class:"fab fa-google text-red-500 me-2"},null,-1)])),default:l(()=>[o[6]||(o[6]=y(" Log in with Google "))]),_:1,__:[6]}),o[11]||(o[11]=s("div",{class:"flex items-center mb-6"},[s("div",{class:"flex-grow border-t border-gray-200"}),s("div",{class:"mx-4 text-gray-400 text-sm"},"OR"),s("div",{class:"flex-grow border-t border-gray-200"})],-1)),s("form",{onSubmit:o[2]||(o[2]=J((...v)=>n(g)&&n(g)(...v),["prevent"]))},[s("div",Y,[o[7]||(o[7]=s("label",{for:"email",class:"block text-sm font-normal text-gray-600 mb-1"},"Your username",-1)),p(C,{modelValue:n(c),"onUpdate:modelValue":o[0]||(o[0]=v=>B(c)?c.value=v:null),id:"email",placeholder:"Username",class:"w-full",required:""},null,8,["modelValue"])]),s("div",H,[o[8]||(o[8]=s("label",{for:"password",class:"block text-sm font-normal text-gray-600 mb-1"},"Your password",-1)),p(C,{modelValue:n(h),"onUpdate:modelValue":o[1]||(o[1]=v=>B(h)?h.value=v:null),id:"password",type:n(d)?"text":"password",placeholder:"Password",class:"w-full",required:""},{append:l(()=>[p(w,{icon:"",size:"small",color:"gray",onClick:n(b)},{default:l(()=>[s("i",{class:R(n(d)?"fa fa-eye-slash":"fa fa-eye")},null,2)]),_:1},8,["onClick"])]),_:1},8,["modelValue","type"]),o[9]||(o[9]=s("div",{class:"text-right mt-1"},[s("a",{href:"/ForgotPass",class:"text-xs text-gray-600 hover:underline"},"Forgot your password?")],-1))]),n(k)?(T(),N(j,{key:0,class:"mt-2 mb-2",color:"danger",outlined:""},{default:l(()=>[y(x(n(k)),1)]),_:1})):V("",!0),p(w,{type:"submit",class:"w-full mt-4",color:"#f0f0f0","text-color":"#333",loading:n(f),disabled:n(f)},{default:l(()=>[y(x(n(f)?"Logging in...":"Log in"),1)]),_:1},8,["loading","disabled"])],32),n(i)||n(m)?(T(),N(j,{key:0,class:"mt-4",color:"success",outlined:""},{default:l(()=>[s("p",null,x(n(i)),1),s("p",null,x(n(m)),1)]),_:1})):V("",!0)])])}}},U=W(Q,[["__scopeId","data-v-3a8d647d"]]);export{U as default};
