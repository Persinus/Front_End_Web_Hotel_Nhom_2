import{B as O,C as w,h as g,l as V,k as B,D as N,c as P,a as r,e as F,g as I,i as C,d as x,y as A,b as y,E as j,x as i,w as p,r as S,o as _,n as J,t as L}from"./XxkKQ-J5.js";import{s as G}from"./x_rD_Ya3.js";import{_ as $}from"./DlAUqK2U.js";const E=O("auth",{state:()=>({user:null,token:null,isLoading:!1,error:null}),getters:{isAuthenticated:e=>!!e.token,authToken:e=>e.token,userInfo:e=>e.user,bearerToken:e=>e.token?`Bearer ${e.token}`:null},actions:{async login(e,t){this.isLoading=!0,this.error=null;try{const o=await fetch("https://nhom2webkhachsan.runasp.net/api/allowanonymous/dangnhap",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tenTaiKhoan:e,matKhau:t})}),l=await o.json();return o.ok?(this.setUser({username:e}),this.setToken(l.token),{success:!0}):(this.error=l.message||"Sai tên tài khoản hoặc mật khẩu!",{success:!1,error:this.error})}catch(o){return this.error="Lỗi kết nối đến máy chủ. Vui lòng thử lại sau.",console.error("Login error:",o),{success:!1,error:this.error}}finally{this.isLoading=!1}},async loginWithGoogle(e){this.isLoading=!0,this.error=null;try{const t=await fetch("https://nhom2webkhachsan.runasp.net/api/allowanonymous/dangnhapgoogle",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,googleId:e.id})}),o=await t.json();return t.ok?(this.setUser({username:e.email,email:e.email,name:e.name,provider:"google"}),this.setToken(o.token||"google-token"),{success:!0}):(this.error=o.message||"Đăng nhập Google thất bại",{success:!1,error:this.error})}catch(t){return console.error("Google login error:",t),this.setUser({username:e.email,email:e.email,name:e.name,provider:"google"}),this.setToken("google-token"),{success:!0}}finally{this.isLoading=!1}},async loginWithFacebook(e){this.isLoading=!0,this.error=null;try{const t=await fetch("https://nhom2webkhachsan.runasp.net/api/allowanonymous/dangnhapfacebook",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,facebookId:e.id})}),o=await t.json();return t.ok?(this.setUser({username:e.email,email:e.email,name:e.name,provider:"facebook"}),this.setToken(o.token||"facebook-token"),{success:!0}):(this.error=o.message||"Đăng nhập Facebook thất bại",{success:!1,error:this.error})}catch(t){return console.error("Facebook login error:",t),this.setUser({username:e.email,email:e.email,name:e.name,provider:"facebook"}),this.setToken("facebook-token"),{success:!0}}finally{this.isLoading=!1}},logout(){this.user=null,this.token=null,localStorage.removeItem("userToken"),localStorage.removeItem("userName"),localStorage.removeItem("userInfo"),w(null)},setUser(e){this.user=e,localStorage.setItem("userInfo",JSON.stringify(e)),localStorage.setItem("userName",e.username)},setToken(e){this.token=e,localStorage.setItem("userToken",e),w(e)},initAuth(){const e=localStorage.getItem("userToken"),t=localStorage.getItem("userInfo");if(e&&(this.token=e,w(e)),t)try{this.user=JSON.parse(t)}catch{console.error("Error parsing user info from localStorage")}}}});function z(){const e=g(""),t=g(""),o=g(""),l=g(""),u=g(!1),c=g(""),k=N(),d=E(),h=["https://i.pinimg.com/474x/a0/fb/38/a0fb38a030da2a14a39767bfd21d48d2.jpg","https://i.pinimg.com/474x/d4/54/76/d45476a670996cd4ae936d99ad0b24e2.jpg","https://i.pinimg.com/474x/f7/41/c8/f741c8636021870390f124e5acaa55e4.jpg"],m=g(0),b=()=>{u.value=!u.value},T=async()=>{try{c.value="";const n=await d.login(o.value,l.value);n.success?(e.value=`Đăng nhập thành công: ${o.value}`,t.value="",setTimeout(()=>{k.push("/")},1e3)):c.value=n.error}catch(n){c.value="Lỗi kết nối đến máy chủ. Vui lòng thử lại sau.",console.error("Login error:",n)}},s=n=>{const a=JSON.parse(atob(n.credential.split(".")[1]));d.loginWithGoogle({email:a.email,name:a.name||a.email.split("@")[0]}),e.value=`Đăng nhập bằng Google: ${a.email}`,t.value=""},v=()=>{FB.login(n=>{n.status==="connected"?FB.api("/me",{fields:"name,email"},a=>{d.loginWithFacebook({email:a.email,name:a.name}),t.value=`Đăng nhập Facebook: ${a.name}`,e.value=`Email: ${a.email}`}):t.value="Chưa đăng nhập Facebook"},{scope:"email"})};return V(()=>{d.initAuth(),G(()=>{m.value=(m.value+1)%h.length},4e3);const n=document.createElement("script");n.src="https://accounts.google.com/gsi/client",n.async=!0,n.defer=!0,document.head.appendChild(n),n.onload=()=>{window.google.accounts.id.initialize({client_id:"351177417132-r5tq1fs5729agapblj6gpmsh0f230f36.apps.googleusercontent.com",callback:s}),window.google.accounts.id.renderButton(document.getElementById("g_id_signin"),{theme:"outline",size:"large",text:"signin_with"})},window.fbAsyncInit=function(){FB.init({appId:"2066643873763098",cookie:!0,xfbml:!0,version:"v12.0"})};const a=document.createElement("script");a.async=!0,a.defer=!0,a.crossOrigin="anonymous",a.src="https://connect.facebook.net/en_US/sdk.js",document.head.appendChild(a)}),{email:e,facebookName:t,formEmail:o,formPassword:l,images:h,currentImageIndex:m,showPassword:u,togglePassword:b,emailLogin:T,facebookLogin:v,isLoading:B(()=>d.isLoading),loginError:c}}const R={class:"login-page min-h-screen w-full flex items-center justify-center bg-cover bg-center"},W={class:"login-modal flex w-full max-w-3xl rounded-md shadow-lg overflow-hidden bg-white"},q={class:"login-right flex flex-col justify-center w-1/2 p-8"},M={class:"mb-4"},D={class:"mb-1"},H={__name:"Login",setup(e){const t=N(),o=E(),{email:l,formEmail:u,formPassword:c,showPassword:k,togglePassword:d,emailLogin:h,isLoading:m,loginError:b}=z();return V(()=>{o.initAuth(),o.isAuthenticated&&t.push("/")}),(T,s)=>{const v=S("va-input"),n=S("va-button"),a=S("va-alert");return _(),P("div",R,[r("div",W,[s[7]||(s[7]=F('<div class="login-left flex flex-col items-center justify-center p-8 bg-gradient-to-br from-blue-500 to-indigo-600 text-white w-1/2" data-v-1fe3d8ff><img alt="OceanView Hotels" class="mb-6 w-20 h-20 object-contain" data-v-1fe3d8ff><h2 class="text-2xl font-bold mb-2" data-v-1fe3d8ff>OceanView Hotels</h2><div class="text-lg font-semibold mb-4" data-v-1fe3d8ff>Luxury Experience</div><div class="text-base mb-1" data-v-1fe3d8ff>Chào mừng trở lại</div><div class="text-base" data-v-1fe3d8ff>Đăng nhập để truy cập tài khoản của bạn</div></div>',1)),r("div",q,[s[6]||(s[6]=r("div",{class:"text-center mb-6"},[r("h1",{class:"text-xl font-semibold"},"Đăng nhập"),r("p",{class:"text-sm text-gray-500 mt-1"},[x(" Chưa có tài khoản? "),r("a",{href:"/Register",class:"text-blue-600 font-medium hover:underline"},"Đăng ký")])],-1)),r("form",{onSubmit:s[2]||(s[2]=A((...f)=>i(h)&&i(h)(...f),["prevent"]))},[r("div",M,[s[3]||(s[3]=r("label",{for:"email",class:"block text-sm font-normal text-gray-600 mb-1"},"Tên đăng nhập",-1)),y(v,{modelValue:i(u),"onUpdate:modelValue":s[0]||(s[0]=f=>j(u)?u.value=f:null),id:"email",placeholder:"Username",class:"w-full",required:""},null,8,["modelValue"])]),r("div",D,[s[4]||(s[4]=r("label",{for:"password",class:"block text-sm font-normal text-gray-600 mb-1"},"Mật khẩu",-1)),y(v,{modelValue:i(c),"onUpdate:modelValue":s[1]||(s[1]=f=>j(c)?c.value=f:null),id:"password",type:i(k)?"text":"password",placeholder:"Password",class:"w-full",required:""},{append:p(()=>[y(n,{icon:"",size:"small",color:"gray",onClick:i(d),type:"button"},{default:p(()=>[r("i",{class:J(i(k)?"fa fa-eye-slash":"fa fa-eye")},null,2)]),_:1},8,["onClick"])]),_:1},8,["modelValue","type"]),s[5]||(s[5]=r("div",{class:"text-right mt-1"},[r("a",{href:"/ForgotPass",class:"text-xs text-gray-600 hover:underline"},"Quên mật khẩu?")],-1))]),i(b)?(_(),I(a,{key:0,class:"mt-2 mb-2",color:"danger",outlined:""},{default:p(()=>[x(L(i(b)),1)]),_:1})):C("",!0),y(n,{type:"submit",class:"w-full mt-4",color:"#0ea5e9","text-color":"#fff",loading:i(m),disabled:i(m)},{default:p(()=>[x(L(i(m)?"Đang đăng nhập...":"Đăng nhập"),1)]),_:1},8,["loading","disabled"])],32),i(l)?(_(),I(a,{key:0,class:"mt-4",color:"success",outlined:""},{default:p(()=>[r("p",null,L(i(l)),1)]),_:1})):C("",!0)])])])}}},Z=$(H,[["__scopeId","data-v-1fe3d8ff"]]);export{Z as default};
