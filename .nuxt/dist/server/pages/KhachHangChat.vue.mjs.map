{"version":3,"file":"KhachHangChat.vue.mjs","sources":["../../../../pages/KhachHangChat.vue"],"sourcesContent":["<template>\r\n  <div class=\"chat-container\">\r\n    <h1>ðŸ’¬ Chat vá»›i Quáº£n Trá»‹ ViÃªn</h1>\r\n\r\n    <!-- Khu vá»±c chat -->\r\n    <div class=\"chat-box\">\r\n      <div class=\"messages\">\r\n        <div\r\n          v-for=\"(message, index) in messages\"\r\n          :key=\"index\"\r\n          :class=\"message.isAdmin ? 'admin-message' : 'customer-message'\"\r\n        >\r\n          {{ message.text }}\r\n        </div>\r\n      </div>\r\n      <div class=\"chat-input\">\r\n        <input\r\n          type=\"text\"\r\n          v-model=\"newMessage\"\r\n          placeholder=\"Nháº­p tin nháº¯n...\"\r\n          @keyup.enter=\"sendMessage\"\r\n        />\r\n        <button @click=\"sendMessage\">Gá»­i</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script setup>\r\nimport { ref, onMounted, onBeforeUnmount } from 'vue';\r\nimport * as signalR from '@microsoft/signalr';\r\n\r\nconst messages = ref([]); // Tin nháº¯n trong cuá»™c trÃ² chuyá»‡n\r\nconst newMessage = ref(''); // Tin nháº¯n má»›i\r\nconst customerId = 'KH001'; // MÃ£ khÃ¡ch hÃ ng (tá»± Ä‘á»™ng láº¥y tá»« há»‡ thá»‘ng khÃ¡ch hÃ ng)\r\nconst adminId = 'QT001'; // MÃ£ quáº£n trá»‹ viÃªn (Ä‘Æ°á»£c gÃ¡n tá»± Ä‘á»™ng)\r\n\r\nlet connection = null;\r\n\r\n// Thiáº¿t láº­p káº¿t ná»‘i SignalR\r\nconst setupSignalR = async () => {\r\n  connection = new signalR.HubConnectionBuilder()\r\n    .withUrl('http://nhom2webkhachsan.runasp.net/chathub') // ÄÆ°á»ng dáº«n tá»›i SignalR Hub\r\n    .withAutomaticReconnect()\r\n    .build();\r\n\r\n  // Láº¯ng nghe tin nháº¯n nháº­n Ä‘Æ°á»£c tá»« quáº£n trá»‹ viÃªn\r\n  connection.on('ReceiveMessage', (user, message) => {\r\n    console.log('Tin nháº¯n nháº­n Ä‘Æ°á»£c tá»«:', user, 'Ná»™i dung:', message); // Log tin nháº¯n nháº­n Ä‘Æ°á»£c\r\n    if (user === adminId) {\r\n      messages.value.push({ text: message, isAdmin: true }); // Tin nháº¯n tá»« quáº£n trá»‹ viÃªn\r\n    }\r\n  });\r\n\r\n  try {\r\n    await connection.start();\r\n    console.log('SignalR Ä‘Ã£ káº¿t ná»‘i'); // Log khi káº¿t ná»‘i thÃ nh cÃ´ng\r\n  } catch (error) {\r\n    console.error('Lá»—i khi káº¿t ná»‘i SignalR:', error); // Log lá»—i khi káº¿t ná»‘i tháº¥t báº¡i\r\n  }\r\n};\r\n\r\n// Gá»­i tin nháº¯n tá»›i quáº£n trá»‹ viÃªn\r\nconst sendMessage = async () => {\r\n  if (!newMessage.value.trim()) return;\r\n\r\n  const message = newMessage.value.trim();\r\n  messages.value.push({ text: message, isAdmin: false }); // Tin nháº¯n tá»« khÃ¡ch hÃ ng\r\n  console.log('Tin nháº¯n gá»­i Ä‘i:', message); // Log tin nháº¯n gá»­i Ä‘i\r\n\r\n  try {\r\n    // MÃ£ adminId ('QT001') Ä‘Æ°á»£c tá»± Ä‘á»™ng gÃ¡n táº¡i Ä‘Ã¢y\r\n    await connection.invoke('SendMessageToAdmin', customerId, message);\r\n    console.log(`Tin nháº¯n Ä‘Ã£ gá»­i Ä‘áº¿n quáº£n trá»‹ viÃªn ${adminId}:`, message); // Log khi gá»­i thÃ nh cÃ´ng\r\n    newMessage.value = ''; // XÃ³a ná»™i dung input sau khi gá»­i\r\n  } catch (error) {\r\n    console.error('Lá»—i khi gá»­i tin nháº¯n:', error); // Log lá»—i khi gá»­i tin nháº¯n\r\n  }\r\n};\r\n\r\nonMounted(async () => {\r\n  console.log('Khá»Ÿi táº¡o SignalR...'); // Log khi báº¯t Ä‘áº§u khá»Ÿi táº¡o\r\n  await setupSignalR();\r\n});\r\n\r\nonBeforeUnmount(() => {\r\n  if (connection) {\r\n    connection.stop()\r\n      .then(() => console.log('SignalR Ä‘Ã£ ngáº¯t káº¿t ná»‘i')) // Log khi ngáº¯t káº¿t ná»‘i thÃ nh cÃ´ng\r\n      .catch(err => console.error('Lá»—i khi ngáº¯t káº¿t ná»‘i SignalR:', err)); // Log lá»—i khi ngáº¯t káº¿t ná»‘i\r\n  }\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.chat-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 20px;\r\n  padding: 20px;\r\n  max-width: 800px;\r\n  margin: auto;\r\n}\r\n\r\n.chat-box {\r\n  border: 1px solid #ddd;\r\n  border-radius: 8px;\r\n  padding: 10px;\r\n}\r\n\r\n.messages {\r\n  max-height: 300px;\r\n  overflow-y: auto;\r\n  margin-bottom: 10px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 8px;\r\n  padding: 10px;\r\n}\r\n\r\n.admin-message {\r\n  text-align: left;\r\n  color: blue;\r\n}\r\n\r\n.customer-message {\r\n  text-align: right;\r\n  color: green;\r\n}\r\n\r\n.chat-input {\r\n  display: flex;\r\n  gap: 10px;\r\n}\r\n\r\n.chat-input input {\r\n  flex: 1;\r\n  padding: 10px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 8px;\r\n}\r\n\r\n.chat-input button {\r\n  padding: 10px 20px;\r\n  background-color: #007bff;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 8px;\r\n  cursor: pointer;\r\n}\r\n\r\n.chat-input button:hover {\r\n  background-color: #0056b3;\r\n}\r\n</style>\r\n"],"names":[],"mappings":";;;;;;;;AA+BA,UAAM,WAAW,IAAI,CAAA,CAAE;AACvB,UAAM,aAAa,IAAI,EAAE;;;;;;;;;;;;;;;;;"}